---
- name: Test Address Info Module
  hosts: localhost
  gather_facts: false
  vars_files:
    - vault.yaml
  vars:
    provider:
      client_id: "{{ client_id }}"
      client_secret: "{{ client_secret }}"
      tsg_id: "{{ tsg_id }}"
      log_level: "INFO"
  tasks:
    # First create some test data using the address module
    - name: Create netmask address object
      cdot65.scm.address:
        provider: "{{ provider }}"
        name: "Test_Address_Netmask"
        description: "Test netmask address"
        ip_netmask: "192.168.1.0/24"
        folder: "Texas"
        state: "present"
      
    - name: Create range address object
      cdot65.scm.address:
        provider: "{{ provider }}"
        name: "Test_Address_Range"
        description: "Test range address"
        ip_range: "192.168.2.1-192.168.2.254"
        folder: "Texas"
        state: "present"
        
    - name: Create FQDN address object
      cdot65.scm.address:
        provider: "{{ provider }}"
        name: "Test_Address_FQDN"
        description: "Test FQDN address"
        fqdn: "example.com"
        folder: "Texas"
        state: "present"
      
    # Test retrieving a specific address
    - name: Get information about a specific address
      cdot65.scm.address_info:
        provider: "{{ provider }}"
        name: "Test_Address_Netmask"
        folder: "Texas"
      register: specific_address_info
      
    - name: Display specific address information
      debug:
        var: specific_address_info
      
    # Test listing all addresses in a folder
    - name: List all address objects in the folder
      cdot65.scm.address_info:
        provider: "{{ provider }}"
        folder: "Texas"
      register: all_addresses_info
    
    - name: Display all addresses information
      debug:
        var: all_addresses_info
      
    # Clean up test data
    - name: Remove test address objects
      cdot65.scm.address:
        provider: "{{ provider }}"
        name: "{{ item }}"
        folder: "Texas"
        state: "absent"
      loop:
        - "Test_Address_Netmask"
        - "Test_Address_Range"
        - "Test_Address_FQDN"
